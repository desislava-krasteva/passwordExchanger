<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" xmlns:th="http://www.w3.org/1999/xhtml"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PASSEX Add new group</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
  <script type="text/javascript">
    var name=document.getElementById("name");
  function onInput(){
        console.log("onInput");

        var duration = 1000;
        clearTimeout(name._timer);
        name._timer = setTimeout(()=>{
            validateName(this.value);
        }, duration);
    }
function validateName(){
       var name=document.getElementById("name").value;
                var nameReg = /^[a-zA-Z\s]*$/;
if (!nameReg.test(name) || name.length === 0) {
  $('#name_error').text("Name is incorrect. Should contain only letters.").show();
}
else{
              var data ={user_id:"",password:name};
              if(name.value==""){

                document.getElementById("AddGroup").disabled = true;
                        $('#name_error').text('Name can not be empty!').show();
              }
              else{

$.ajax({
    type: "POST",
    url : "/validateGroupName",
    data: data,
    success: function (data) {
                    if(data=="correct"){
                        document.getElementById("AddGroup").disabled = false;

                        $('#name_error').text('');
                    }
                    if(data=="incorrect"){
                        document.getElementById("AddGroup").disabled = true;
                        $('#name_error').text('Name is already taken!').show();

                    }
                },
    error: function () {
},
  });
}
}
}

function createRole(){

var name=document.getElementById("name").value;
   var data ={user_id:"" ,password:name};
Swal.fire({
title: 'Do you want to save the changes?',
showCancelButton: true,
confirmButtonText: 'Yes',
denyButtonText: 'No',
customClass: {
  actions: 'my-actions',
  cancelButton: 'order-1 right-gap btn swal-cancel',
  confirmButton: 'order-2 btn swal-primary',
},
}).then((result) => {
if (result.isConfirmed) {
  Swal.fire({
    title: "Saved!",
    text: "The group has been saved.",
    icon: "success",
    customClass: {
      confirmButton: 'btn swal-primary',
    }
  });
              document.getElementById('formAddGroup').submit();

}
else if (result.isDenied) {
  Swal.fire('Changes are not saved', '', 'info')
}
});
}
$(document).ready(function () {
                        document.getElementById("AddGroup").disabled = true;

var name=document.getElementById("name");
          name.addEventListener('input', onInput);
$('.error-message').hide();
});
  </script>
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-md-offset-4">
          <form th:action="@{/admin/addNewGroup}"  id="formAddGroup" method="POST" class="fh5co-form animate-box" data-animate-effect="fadeIn">
            <h2>Create new group</h2>
            <input class="form-control"
                   type="hidden"
                   th:value="${user_id}"
                   id="user_id"
                   name="user_id"/>
            <div class="form-group">
              <label for="name" class="sr-only">Group name</label>
              <input
                      type = "text"
                      name = "name"
                      class = "form-control"
                      placeholder="Group name"
                      id="name"
                      required
              />
              <p id="name_error" class="error-message">
              </p>
            </div>
            <div class ="form-group">
              <button type="button" id="AddGroup" class="btn btn-primary" th:attr="onclick=|createRole()|" disabled>Add</button>
              <input type="button" value="Back" class="btn btn-cancel" onclick="window.history.back();">
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
